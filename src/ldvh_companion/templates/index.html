{% extends "base.html" %}

{% block title %}Accueil - LDVH Companion{% endblock %}

{% block content %}
<div class="text-center mb-12">
    <h1 class="medieval-font text-5xl text-amber-800 mb-4">
        <i class="fas fa-scroll mr-4"></i>
        LDVH Companion
    </h1>
    <p class="text-xl text-gray-600 max-w-3xl mx-auto">
        Votre compagnon numérique pour gérer et suivre vos feuilles d'aventures
        dans les livres dont vous êtes le héros
    </p>
</div>

<!-- Statistiques rapides -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
    <div class="bg-white rounded-lg shadow-md p-6 text-center">
        <div class="text-3xl text-amber-600 mb-2">
            <i class="fas fa-books"></i>
        </div>
        <h3 class="text-lg font-semibold text-gray-800 mb-2">Séries</h3>
        <p class="text-3xl font-bold text-amber-800" id="series-count">-</p>
        <p class="text-sm text-gray-500">Séries de livres</p>
    </div>

    <div class="bg-white rounded-lg shadow-md p-6 text-center">
        <div class="text-3xl text-amber-600 mb-2">
            <i class="fas fa-book"></i>
        </div>
        <h3 class="text-lg font-semibold text-gray-800 mb-2">Livres</h3>
        <p class="text-3xl font-bold text-amber-800" id="books-count">-</p>
        <p class="text-sm text-gray-500">Tomes disponibles</p>
    </div>

    <div class="bg-white rounded-lg shadow-md p-6 text-center">
        <div class="text-3xl text-amber-600 mb-2">
            <i class="fas fa-scroll"></i>
        </div>
        <h3 class="text-lg font-semibold text-gray-800 mb-2">Aventures</h3>
        <p class="text-3xl font-bold text-amber-800" id="sheets-count">-</p>
        <p class="text-sm text-gray-500">Feuilles créées</p>
    </div>
</div>

<!-- Outils rapides -->
<div class="bg-white rounded-lg shadow-md p-8 mb-12">
    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">
        <i class="fas fa-dice mr-3 text-amber-600"></i>
        Outils de Jeu
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <button onclick="rollDice('1d6')"
                class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-4 px-6 rounded-lg transition-colors duration-200 flex flex-col items-center">
            <i class="fas fa-dice text-2xl mb-2"></i>
            <span>Lancer 1d6</span>
        </button>

        <button onclick="rollDice('2d6')"
                class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-4 px-6 rounded-lg transition-colors duration-200 flex flex-col items-center">
            <i class="fas fa-dice-d20 text-2xl mb-2"></i>
            <span>Lancer 2d6</span>
        </button>

        <button onclick="calculateInitialStats()"
                class="bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-lg transition-colors duration-200 flex flex-col items-center">
            <i class="fas fa-user-plus text-2xl mb-2"></i>
            <span>Calculer Stats</span>
        </button>

        <button onclick="window.location.href='/adventure-sheets'"
                class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-lg transition-colors duration-200 flex flex-col items-center">
            <i class="fas fa-plus text-2xl mb-2"></i>
            <span>Nouvelle Fiche</span>
        </button>
    </div>
</div>

<!-- Fonctionnalités principales -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
    <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center mb-4">
            <div class="bg-amber-100 p-3 rounded-full mr-4">
                <i class="fas fa-books text-amber-600 text-xl"></i>
            </div>
            <h3 class="text-xl font-semibold text-gray-800">Gestion des Séries</h3>
        </div>
        <p class="text-gray-600 mb-4">
            Créez et organisez vos séries de livres dont vous êtes le héros.
            Ajoutez de nouveaux tomes et suivez leur progression.
        </p>
        <a href="/series" class="inline-flex items-center text-amber-600 hover:text-amber-700 font-medium">
            Gérer les séries
            <i class="fas fa-arrow-right ml-2"></i>
        </a>
    </div>

    <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center mb-4">
            <div class="bg-amber-100 p-3 rounded-full mr-4">
                <i class="fas fa-scroll text-amber-600 text-xl"></i>
            </div>
            <h3 class="text-xl font-semibold text-gray-800">Feuilles d'Aventures</h3>
        </div>
        <p class="text-gray-600 mb-4">
            Créez des feuilles d'aventures pour chaque tentative.
            Suivez vos statistiques, inventaire et rencontres de monstres.
        </p>
        <a href="/adventure-sheets" class="inline-flex items-center text-amber-600 hover:text-amber-700 font-medium">
            Gérer les feuilles
            <i class="fas fa-arrow-right ml-2"></i>
        </a>
    </div>
</div>

<!-- Séries populaires -->
<div class="bg-white rounded-lg shadow-md p-6">
    <h2 class="text-2xl font-bold text-gray-800 mb-6">
        <i class="fas fa-star mr-3 text-amber-600"></i>
        Séries Disponibles
    </h2>
    <div id="popular-series" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <!-- Les séries seront chargées dynamiquement -->
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Charger les statistiques au chargement de la page
document.addEventListener('DOMContentLoaded', function() {
    loadDashboardStats();
    loadPopularSeries();
});

async function loadDashboardStats() {
    try {
        // Charger le nombre de séries
        const seriesResponse = await fetch('/api/series');
        if (seriesResponse.ok) {
            const series = await seriesResponse.json();
            document.getElementById('series-count').textContent = series.length;
        }

        // Charger le nombre de livres
        const booksResponse = await fetch('/api/books');
        if (booksResponse.ok) {
            const books = await booksResponse.json();
            document.getElementById('books-count').textContent = books.length;
        }

        // Charger le nombre de feuilles d'aventures
        const sheetsResponse = await fetch('/api/adventure-sheets');
        if (sheetsResponse.ok) {
            const sheets = await sheetsResponse.json();
            document.getElementById('sheets-count').textContent = sheets.length;
        }
    } catch (error) {
        console.error('Erreur lors du chargement des statistiques:', error);
    }
}

async function loadPopularSeries() {
    try {
        const response = await fetch('/api/series');
        if (response.ok) {
            const series = await response.json();
            const container = document.getElementById('popular-series');

            if (series.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center col-span-full">Aucune série disponible pour le moment.</p>';
                return;
            }

            container.innerHTML = series.map(s => `
                <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow duration-200">
                    <h3 class="font-semibold text-gray-800 mb-2">${s.name}</h3>
                    <p class="text-sm text-gray-600 mb-3">${s.description || 'Aucune description'}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-gray-500">
                            Créée le ${new Date(s.created_at).toLocaleDateString('fr-FR')}
                        </span>
                        <a href="/series" class="text-amber-600 hover:text-amber-700 text-sm font-medium">
                            Voir détails
                        </a>
                    </div>
                </div>
            `).join('');
        }
    } catch (error) {
        console.error('Erreur lors du chargement des séries:', error);
    }
}
</script>
{% endblock %}
